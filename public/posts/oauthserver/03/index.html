<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme=""
  
    class="html theme--light"
  
><head>
  <title>
    
        |
        Implement an OAuth 2.0 Server (Part 03)
      

    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.68.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="" />
  <meta
    name="description"
    content="We&#39;re still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server."
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.ba004976221e613a16542d07a2deca5d0377ff5e6a22dec5fcec01480ba967cf.css"
      integrity="sha256-ugBJdiIeYToWVC0Hot7KXQN3/15qIt7F/OwBSAupZ88="
      crossorigin="anonymous"
      type="text/css"
    />
  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.793b323d7f2d9fbfd0b93f4d593fb5ad77b918716ed33eddea403fa87f770403.css"
    integrity="sha256-eTsyPX8tn7/QuT9NWT&#43;1rXe5GHFu0z7d6kA/qH93BAM="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7f3c2281c7f965ce3c64888aa452793252a0416909c181097f81d0a0f7d1624e.css"
    integrity="sha256-fzwigcf5Zc48ZIiKpFJ5MlKgQWkJwYEJf4HQoPfRYk4="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.35fc032da8ede6681675d20a2f862fb9e1045c1d512d495fcf862c054daffef2.css"
    integrity="sha256-NfwDLajt5mgWddIKL4YvueEEXB1RLUlfz4YsBU2v/vI="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.3b92357925ea7284f0c6b0378396f39f470f7842ed9702f337e667c4026bf837.css"
    integrity="sha256-O5I1eSXqcoTwxrA3g5bzn0cPeELtlwLzN&#43;ZnxAJr&#43;Dc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.ebb1096e1976e8cc4e2532cfa050b8f30eb13b8eb06be5cee3e38eb426b838ea.css"
    integrity="sha256-67EJbhl26MxOJTLPoFC48w6xO46wa&#43;XO4&#43;OOtCa4OOo="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <link rel="canonical" href="https://0xnf.github.io/posts/oauthserver/03/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.5c846cefa5ed21cceee981c70901aaf21b17b4e0b05bd777af840780918abea9.js"
    integrity="sha256-XIRs76XtIczu6YHHCQGq8hsXtOCwW9d3r4QHgJGKvqk="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.46e991c2fcb035fc0060a792f1eb0c93ecacc9e76cd7445d6531a5cf2928686d.js"
      integrity="sha256-RumRwvywNfwAYKeS8esMk&#43;ysyeds10RdZTGlzykoaG0="
      crossorigin="anonymous"
    ></script>
  

  


  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Implement an OAuth 2.0 Server (Part 03)"/>
<meta name="twitter:description" content="We&#39;re still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server."/>



  
  <meta property="og:title" content="Implement an OAuth 2.0 Server (Part 03)" />
<meta property="og:description" content="We&#39;re still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://0xnf.github.io/posts/oauthserver/03/" />
<meta property="article:published_time" content="2018-06-06T16:15:56-07:00" />
<meta property="article:modified_time" content="2018-06-06T16:15:56-07:00" />




  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "posts",
        "name": "Implement an OAuth 2.0 Server (Part 03)",
        "headline": "Implement an OAuth 2.0 Server (Part 03)",
        "alternativeHeadline": "",
        "description": "
      We\x27re still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server.


    ",
        "inLanguage": "en-us",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/0xnf.github.io\/posts\/oauthserver\/03\/"
        },
        "author" : {
            "@type": "Person",
            "name": ""
        },
        "creator" : {
            "@type": "Person",
            "name": ""
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": ""
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": ""
        },
        "copyrightYear" : "2018",
        "dateCreated": "2018-06-06T16:15:56.00Z",
        "datePublished": "2018-06-06T16:15:56.00Z",
        "dateModified": "2018-06-06T16:15:56.00Z",
        "publisher":{
            "@type":"Organization",
            "name":  null ,
            "url": "https://0xnf.github.io/",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/0xnf.github.io\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "https:\/\/0xnf.github.io\/posts\/oauthserver\/03\/",
        "wordCount" : "401",
        "genre" : [ 
      
      "Security"

    
      
        ,

      
      "Identity"

    
      
        ,

      
      "Authentication"

    
      
        ,

      
      "Authorization"

    ],
        "keywords" : [ 
      
      "OAuth2.0"

    
      
        ,

      
      "OpenIdConnect"

    
      
        ,

      
      "Tutorial"

    
      
        ,

      
      "CSharp"

    
      
        ,

      
      ".NET Core"

    ]
    }
  </script>


</head>
<body class="body">
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"
        
      ><div
  class="sidebar
    animated fadeInDown
  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/"></a>
        </div>
      
      <div class="sidebar__introduction-description">
        <p></p>
      </div>
    </div>
    <ul class="sidebar__list">
      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        
        2023
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.7d3bf3472b73d9ba107b3de37d0df8fa736593a3c6638c95eaed42006bfc0193.js"
    integrity="sha256-fTvzRytz2boQez3jfQ34&#43;nNlk6PGY4yV6u1CAGv8AZM="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"
        
      >
        <header class="header"><div
  class="
    animated fadeInDown
  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown
    "
  >
    
    <div class="post__content">
      <h1>Implement an OAuth 2.0 Server (Part 03)</h1>
      <p>Welcome to the third part of a series of posts where we will implement an OAuth 2 Server using <a href="https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server">AspNet.Security.OpenIdConnectServer</a>.</p>
<h1 id="sqlite-and-initial-migration">SQLite and Initial Migration</h1>
<p>If you tried to start the website we just initialized, you&rsquo;d find that you won&rsquo;t be able to login or register, receiving error messages instead of a welcome screen.</p>
<p>Although an initial migration has been provided for us, it hasn&rsquo;t been applied, and no database exists yet. And if we&rsquo;re not careful and rush to apply the migration ourselves we&rsquo;ll end up with a <code>SQL Server</code> dump file. We&rsquo;re going to switch our database provider to <code>SQLite</code>, and we&rsquo;re going to change our default <code>connection string</code> to reflect this.</p>
<h2 id="setting-the-default-connection-string">Setting the Default Connection String</h2>
<p>Open the <code>appsettings.json</code> file and change the &ldquo;DefaultConnection&rdquo; field to</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"> <span style="color:#e6db74">&#34;DefaultConnection&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Data Source=OAuthTutorial.sqlite&#34;</span>
</code></pre></div><h2 id="using-sqlite">Using SQLite</h2>
<p>In <code>Startup.cs</code>, change the highlighted line so that we&rsquo;re using <code>SQLite</code> instead of <code>SQLServer</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
{
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
<span style="display:block;width:100%;background-color:#3c3d38">        options.UseSqlite(Configuration.GetConnectionString(<span style="color:#e6db74">&#34;DefaultConnection&#34;</span>)));
</span>
    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    <span style="color:#75715e">// Add application services.
</span><span style="color:#75715e"></span>    services.AddTransient&lt;IEmailSender, EmailSender&gt;();

    services.AddMvc();
}
</code></pre></div>
<h2 id="password-requirements">Password Requirements</h2>
<p>While we&rsquo;re chilling out in <code>ConfigureServices()</code>, we might as well make some changes to the default password policy, which is strict and difficult. 
Instead of the defaults, we&rsquo;ll have it accept any 6 digit password.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
{
    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
        options.UseSqlite(Configuration.GetConnectionString(<span style="color:#e6db74">&#34;DefaultConnection&#34;</span>)));

<span style="display:block;width:100%;background-color:#3c3d38">    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;((x) =&gt; {
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequiredLength = <span style="color:#ae81ff">6</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequiredUniqueChars = <span style="color:#ae81ff">0</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequireNonAlphanumeric = <span style="color:#66d9ef">false</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequireDigit = <span style="color:#66d9ef">false</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequireLowercase = <span style="color:#66d9ef">false</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">            x.Password.RequireUppercase = <span style="color:#66d9ef">false</span>;
</span><span style="display:block;width:100%;background-color:#3c3d38">        })
</span>        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
        .AddDefaultTokenProviders();

    <span style="color:#75715e">// Add application services.
</span><span style="color:#75715e"></span>    services.AddTransient&lt;IEmailSender, EmailSender&gt;();

    services.AddMvc();
}
</code></pre></div>
<h2 id="apply-the-migration">Apply the Migration</h2>
<p>Now we&rsquo;re ready to update the database for the first time and apply the migration.
Open the <code>Package Manager Console</code> again and enter the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-PowerShell" data-lang="PowerShell">Update-Database
</code></pre></div><p>If you get errors related to the <code>Path</code> of the command, run the command again. The Package Manager Console can be finnicky at times.</p>
<p>It&rsquo;s important to note that with the EF Core + SQLite combination is functional but incomplete.</p>
<p>Specifically with respect to performing migrations that involve <code>Foreign Key</code> relationships. EF cannot migrate any tables that have Foreign Keys, and will crash if you ask it to. To get around this, every time you want to add a new migration, you&rsquo;ll need to delete the old one, delete the old database file, run another <code>Add-Migration</code>, and another <code>Update-Database</code>.</p>
<h1 id="moving-on">Moving On</h1>
<p>The demo of this project to this point can be found <a href="https://github.com/0xNF/OAuthTutorial/tree/03-InitialMigration">here on GitHub</a>.</p>
<p>In the next section, we&rsquo;ll create our initial bare-bones public API.<br>
<a href="/posts/oauthserver/04">Next</a></p>



<h3>Posts in this series</h3>
<ul>
  
    <li><a href="/posts/oauthserver/19/">Implement an OAuth 2.0 Server (Part 19)</a></li>
  
    <li><a href="/posts/oauthserver/18/">Implement an OAuth 2.0 Server (Part 18)</a></li>
  
    <li><a href="/posts/oauthserver/17/">Implement an OAuth 2.0 Server (Part 17)</a></li>
  
    <li><a href="/posts/oauthserver/16/">Implement an OAuth 2.0 Server (Part 16)</a></li>
  
    <li><a href="/posts/oauthserver/15/">Implement an OAuth 2.0 Server (Part 15)</a></li>
  
    <li><a href="/posts/oauthserver/14/">Implement an OAuth 2.0 Server (Part 14)</a></li>
  
    <li><a href="/posts/oauthserver/13/">Implement an OAuth 2.0 Server (Part 13)</a></li>
  
    <li><a href="/posts/oauthserver/12/">Implement an OAuth 2.0 Server (Part 12)</a></li>
  
    <li><a href="/posts/oauthserver/11/">Implement an OAuth 2.0 Server (Part 11)</a></li>
  
    <li><a href="/posts/oauthserver/10/">Implement an OAuth 2.0 Server (Part 10)</a></li>
  
    <li><a href="/posts/oauthserver/09/">Implement an OAuth 2.0 Server (Part 09)</a></li>
  
    <li><a href="/posts/oauthserver/08/">Implement an OAuth 2.0 Server (Part 08)</a></li>
  
    <li><a href="/posts/oauthserver/07/">Implement an OAuth 2.0 Server (Part 07)</a></li>
  
    <li><a href="/posts/oauthserver/06/">Implement an OAuth 2.0 Server (Part 06)</a></li>
  
    <li><a href="/posts/oauthserver/05/">Implement an OAuth 2.0 Server (Part 05)</a></li>
  
    <li><a href="/posts/oauthserver/04/">Implement an OAuth 2.0 Server (Part 04)</a></li>
  
    <li><a href="/posts/oauthserver/03/">Implement an OAuth 2.0 Server (Part 03)</a></li>
  
    <li><a href="/posts/oauthserver/02/">Implement an OAuth 2.0 Server (Part 02)</a></li>
  
    <li><a href="/posts/oauthserver/01/">Implement an OAuth 2.0 Server (Part 01)</a></li>
  
</ul>
</div>
    <div class="post__footer">
      
        <span><a class="category" href="/categories/security/">Security</a><a class="category" href="/categories/identity/">Identity</a><a class="category" href="/categories/authentication/">Authentication</a><a class="category" href="/categories/authorization/">Authorization</a></span>


      

      
        <span><a class="tag" href="/tags/oauth2%2e0/">OAuth2.0</a><a class="tag" href="/tags/openidconnect/">OpenIdConnect</a><a class="tag" href="/tags/tutorial/">Tutorial</a><a class="tag" href="/tags/csharp/">CSharp</a><a class="tag" href="/tags/%2enet-core/">.NET Core</a></span>


      
    </div>

    
  </div>

      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        
        2023
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.7d3bf3472b73d9ba107b3de37d0df8fa736593a3c6638c95eaed42006bfc0193.js"
    integrity="sha256-fTvzRytz2boQez3jfQ34&#43;nNlk6PGY4yV6u1CAGv8AZM="
    crossorigin="anonymous"
  ></script></body>
</html>
