<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><title>|
Implement an OAuth 2.0 Server (Part 03)</title><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content><meta name=description content="We're still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server."><link rel=stylesheet href=/scss/main.min.5794be192d21535bdd301561e043a96b6adbad2b5c08279deff459e4661c613f.css integrity="sha256-V5S+GS0hU1vdMBVh4EOpa2rbrStcCCed7/RZ5GYcYT8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=https://0xnf.github.io/posts/oauthserver/03/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Implement an OAuth 2.0 Server (Part 03)"><meta name=twitter:description content="We're still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server."><meta property="og:title" content="Implement an OAuth 2.0 Server (Part 03)"><meta property="og:description" content="We're still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server."><meta property="og:type" content="article"><meta property="og:url" content="https://0xnf.github.io/posts/oauthserver/03/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-06T16:15:56-07:00"><meta property="article:modified_time" content="2018-06-06T16:15:56-07:00"><meta property="og:see_also" content="https://0xnf.github.io/posts/oauthserver/01/"><meta property="og:see_also" content="https://0xnf.github.io/posts/oauthserver/02/"><meta property="og:see_also" content="https://0xnf.github.io/posts/oauthserver/04/"><meta property="og:see_also" content="https://0xnf.github.io/posts/oauthserver/05/"><meta property="og:see_also" content="https://0xnf.github.io/posts/oauthserver/06/"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Implement an OAuth 2.0 Server (Part 03)","headline":"Implement an OAuth 2.0 Server (Part 03)","alternativeHeadline":"","description":"
      We\u0027re still at the beginning of our OAuth 2 server tutorial, where we spend some time getting familiar with password requirements and Entity Framework migrations. Also we show how to make an ASP.NET Core project use SQLite instead of SQL Server.


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/0xnf.github.io\/posts\/oauthserver\/03\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":{"@type":"Person","name":""},"copyrightYear":"2018","dateCreated":"2018-06-06T16:15:56.00Z","datePublished":"2018-06-06T16:15:56.00Z","dateModified":"2018-06-06T16:15:56.00Z","publisher":{"@type":"Organization","name":null,"url":"https://0xnf.github.io/","logo":{"@type":"ImageObject","url":"https:\/\/0xnf.github.io\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/0xnf.github.io\/posts\/oauthserver\/03\/","wordCount":"401","genre":["Security","Identity","Authentication","Authorization"],"keywords":["OAuth2.0","OpenIdConnect","Tutorial","CSharp",".NET Core"]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/ alt="profile picture"><div class=sidebar__introduction-title><a href=/></a></div><div class=sidebar__introduction-description><p></p></div></div><ul class=sidebar__list></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Implement an OAuth 2.0 Server (Part 03)</h1><p>Welcome to the third part of a series of posts where we will implement an OAuth 2 Server using <a href=https://github.com/aspnet-contrib/AspNet.Security.OpenIdConnect.Server>AspNet.Security.OpenIdConnectServer</a>.</p><h1 id=sqlite-and-initial-migration>SQLite and Initial Migration</h1><p>If you tried to start the website we just initialized, you&rsquo;d find that you won&rsquo;t be able to login or register, receiving error messages instead of a welcome screen.</p><p>Although an initial migration has been provided for us, it hasn&rsquo;t been applied, and no database exists yet. And if we&rsquo;re not careful and rush to apply the migration ourselves we&rsquo;ll end up with a <code>SQL Server</code> dump file. We&rsquo;re going to switch our database provider to <code>SQLite</code>, and we&rsquo;re going to change our default <code>connection string</code> to reflect this.</p><h2 id=setting-the-default-connection-string>Setting the Default Connection String</h2><p>Open the <code>appsettings.json</code> file and change the &ldquo;DefaultConnection&rdquo; field to</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=display:flex><span> <span style=color:#e6db74>&#34;DefaultConnection&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Data Source=OAuthTutorial.sqlite&#34;</span>
</span></span></code></pre></div><h2 id=using-sqlite>Using SQLite</h2><p>In <code>Startup.cs</code>, change the highlighted line so that we&rsquo;re using <code>SQLite</code> instead of <code>SQLServer</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>        options.UseSqlite(Configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;()
</span></span><span style=display:flex><span>        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
</span></span><span style=display:flex><span>        .AddDefaultTokenProviders();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add application services.</span>
</span></span><span style=display:flex><span>    services.AddTransient&lt;IEmailSender, EmailSender&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    services.AddMvc();
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=password-requirements>Password Requirements</h2><p>While we&rsquo;re chilling out in <code>ConfigureServices()</code>, we might as well make some changes to the default password policy, which is strict and difficult.
Instead of the defaults, we&rsquo;ll have it accept any 6 digit password.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
</span></span><span style=display:flex><span>        options.UseSqlite(Configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    services.AddIdentity&lt;ApplicationUser, IdentityRole&gt;((x) =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequiredLength = <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequiredUniqueChars = <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequireNonAlphanumeric = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequireDigit = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequireLowercase = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>            x.Password.RequireUppercase = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>        })
</span></span><span style=display:flex><span>        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
</span></span><span style=display:flex><span>        .AddDefaultTokenProviders();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add application services.</span>
</span></span><span style=display:flex><span>    services.AddTransient&lt;IEmailSender, EmailSender&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    services.AddMvc();
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=apply-the-migration>Apply the Migration</h2><p>Now we&rsquo;re ready to update the database for the first time and apply the migration.
Open the <code>Package Manager Console</code> again and enter the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span>Update-Database
</span></span></code></pre></div><p>If you get errors related to the <code>Path</code> of the command, run the command again. The Package Manager Console can be finnicky at times.</p><p>It&rsquo;s important to note that with the EF Core + SQLite combination is functional but incomplete.</p><p>Specifically with respect to performing migrations that involve <code>Foreign Key</code> relationships. EF cannot migrate any tables that have Foreign Keys, and will crash if you ask it to. To get around this, every time you want to add a new migration, you&rsquo;ll need to delete the old one, delete the old database file, run another <code>Add-Migration</code>, and another <code>Update-Database</code>.</p><h1 id=moving-on>Moving On</h1><p>The demo of this project to this point can be found <a href=https://github.com/0xNF/OAuthTutorial/tree/03-InitialMigration>here on GitHub</a>.</p><p>In the next section, we&rsquo;ll create our initial bare-bones public API.<br><a href=/posts/oauthserver/04>Next</a></p><h3>Posts in this series</h3><ul><li><a href=/posts/oauthserver/19/>Implement an OAuth 2.0 Server (Part 19)</a></li><li><a href=/posts/oauthserver/18/>Implement an OAuth 2.0 Server (Part 18)</a></li><li><a href=/posts/oauthserver/17/>Implement an OAuth 2.0 Server (Part 17)</a></li><li><a href=/posts/oauthserver/16/>Implement an OAuth 2.0 Server (Part 16)</a></li><li><a href=/posts/oauthserver/15/>Implement an OAuth 2.0 Server (Part 15)</a></li><li><a href=/posts/oauthserver/14/>Implement an OAuth 2.0 Server (Part 14)</a></li><li><a href=/posts/oauthserver/13/>Implement an OAuth 2.0 Server (Part 13)</a></li><li><a href=/posts/oauthserver/12/>Implement an OAuth 2.0 Server (Part 12)</a></li><li><a href=/posts/oauthserver/11/>Implement an OAuth 2.0 Server (Part 11)</a></li><li><a href=/posts/oauthserver/10/>Implement an OAuth 2.0 Server (Part 10)</a></li><li><a href=/posts/oauthserver/09/>Implement an OAuth 2.0 Server (Part 09)</a></li><li><a href=/posts/oauthserver/08/>Implement an OAuth 2.0 Server (Part 08)</a></li><li><a href=/posts/oauthserver/07/>Implement an OAuth 2.0 Server (Part 07)</a></li><li><a href=/posts/oauthserver/06/>Implement an OAuth 2.0 Server (Part 06)</a></li><li><a href=/posts/oauthserver/05/>Implement an OAuth 2.0 Server (Part 05)</a></li><li><a href=/posts/oauthserver/04/>Implement an OAuth 2.0 Server (Part 04)</a></li><li><a href=/posts/oauthserver/03/>Implement an OAuth 2.0 Server (Part 03)</a></li><li><a href=/posts/oauthserver/02/>Implement an OAuth 2.0 Server (Part 02)</a></li><li><a href=/posts/oauthserver/01/>Implement an OAuth 2.0 Server (Part 01)</a></li></ul></div><div class=post__footer><span><a class=category href=/categories/security/>Security</a><a class=category href=/categories/identity/>Identity</a><a class=category href=/categories/authentication/>Authentication</a><a class=category href=/categories/authorization/>Authorization</a></span>
<span><a class=tag href=/tags/oauth2%2e0/>OAuth2.0</a><a class=tag href=/tags/openidconnect/>OpenIdConnect</a><a class=tag href=/tags/tutorial/>Tutorial</a><a class=tag href=/tags/csharp/>CSharp</a><a class=tag href=/tags/%2enet-core/>.NET Core</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>