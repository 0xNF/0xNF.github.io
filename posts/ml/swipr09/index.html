<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><title>|
Swipr - Datastore</title><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content><meta name=description content="Part 9 of the Swipr series. After completing our discussion on LibSwipr, we briefly describe what the datastore looks like."><link rel=stylesheet href=/scss/main.min.5794be192d21535bdd301561e043a96b6adbad2b5c08279deff459e4661c613f.css integrity="sha256-V5S+GS0hU1vdMBVh4EOpa2rbrStcCCed7/RZ5GYcYT8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=https://0xnf.github.io/posts/ml/swipr09/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Swipr - Datastore"><meta name=twitter:description content="Part 9 of the Swipr series. After completing our discussion on LibSwipr, we briefly describe what the datastore looks like."><meta property="og:title" content="Swipr - Datastore"><meta property="og:description" content="Part 9 of the Swipr series. After completing our discussion on LibSwipr, we briefly describe what the datastore looks like."><meta property="og:type" content="article"><meta property="og:url" content="https://0xnf.github.io/posts/ml/swipr09/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-12-13T15:37:02-08:00"><meta property="article:modified_time" content="2018-12-13T15:37:02-08:00"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr01/"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr02/"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr03/"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr04/"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr05/"><meta property="og:see_also" content="https://0xnf.github.io/posts/ml/swipr06/"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Swipr - Datastore","headline":"Swipr - Datastore","alternativeHeadline":"","description":"
      Part 9 of the Swipr series. After completing our discussion on LibSwipr, we briefly describe what the datastore looks like.


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/0xnf.github.io\/posts\/ml\/swipr09\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":{"@type":"Person","name":""},"copyrightYear":"2018","dateCreated":"2018-12-13T15:37:02.00Z","datePublished":"2018-12-13T15:37:02.00Z","dateModified":"2018-12-13T15:37:02.00Z","publisher":{"@type":"Organization","name":null,"url":"https://0xnf.github.io/","logo":{"@type":"ImageObject","url":"https:\/\/0xnf.github.io\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/0xnf.github.io\/posts\/ml\/swipr09\/","wordCount":"640","genre":["machine learning","fast.ai"],"keywords":["CNN","web scraping","data collection","architecture"]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/ alt="profile picture"><div class=sidebar__introduction-title><a href=/></a></div><div class=sidebar__introduction-description><p></p></div></div><ul class=sidebar__list></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Swipr - Datastore</h1><p>We need a datastore. Primarily so that we can stow a given user&rsquo;s Tinder information &ndash; Facebooked ID, Facebooked password, Facebooked access token, and Tinder access token, &ndash; but also because we now have a complicated application it&rsquo;s state must be preserved somehow.</p><p>We&rsquo;re going to skip talking about tables relating to how ASP.NET Core projects do identity because there are a lot of tables for that. The only thing worth pointing out with respect to that is many of our tables will keep a foreign key to the autogenerated <code>AspNetUsers.Id</code> field.</p><h1 id=tables>Tables</h1><h2 id=auth-tokens>Auth Tokens</h2><p>Our most dangerous table. Due to the pirate nature of how we&rsquo;re interacting with Tinder, we need to keep a live reference to the user&rsquo;s Facebook password, among other things, which we store in the <code>AuthTokens</code> table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>AuthTokens<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>                        TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>FacebookId<span style=color:#f92672>`</span>                    TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>FacebookAuthenticationToken<span style=color:#f92672>`</span>   INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>TinderAuthenticationToken<span style=color:#f92672>`</span>     INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>FacebookPassword<span style=color:#f92672>`</span>              TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>FacebookEmail<span style=color:#f92672>`</span>	                TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>AspNetUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=swiprconfigs>SwiprConfigs</h2><p>This is the meat of the application, and the core of what is considered to be a Swipr user:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>SwiprConfigs<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>                TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MustHaveBio<span style=color:#f92672>`</span>           INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>BioLikeKeywords<span style=color:#f92672>`</span>       TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>BioSuperlikeKeywords<span style=color:#f92672>`</span>  TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>BioBannedKeywords<span style=color:#f92672>`</span>     INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>AgesEnabled<span style=color:#f92672>`</span>           INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MinimumAge<span style=color:#f92672>`</span>            INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>18</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MaximumAge<span style=color:#f92672>`</span>            INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>DistanceEnabled<span style=color:#f92672>`</span>       INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MinimumDistance<span style=color:#f92672>`</span>       INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MaximumDistance<span style=color:#f92672>`</span>       INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>PicturesEnabled<span style=color:#f92672>`</span>       INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MinimumPictures<span style=color:#f92672>`</span>       INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>MinimumConfidence<span style=color:#f92672>`</span>     INTEGER <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>40</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>SwiprEnabled<span style=color:#f92672>`</span>          INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>AcceptAll<span style=color:#f92672>`</span>             INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>SessionLimit<span style=color:#f92672>`</span>          INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>1000</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>AspNetUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=tinderusers>TinderUsers</h2><p>for bureaucratic reasons, we want to keep tally of the Tinder user&rsquo;s we see. This is independent of any given Swipr user and is instead an application-wide kind of tracking:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>TinderUsers<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>    TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Name<span style=color:#f92672>`</span>      TEXT,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Birthdate<span style=color:#f92672>`</span> INTEGER,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Gender<span style=color:#f92672>`</span>    INTEGER,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=tinderuseractions>TinderUserActions</h2><p>We want to be able to present a Swipr user with the Tinder users that Swipr has seen, and what action it has taken on their behalf. To do this we keep track of what Tinder profiles each Swipr user has seen here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>TinderUserActions<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>                INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> AUTOINCREMENT,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>SwiprUserId<span style=color:#f92672>`</span>       TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>TinderUserId<span style=color:#f92672>`</span>      TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>DateSeen<span style=color:#f92672>`</span>          INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Action<span style=color:#f92672>`</span>            INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>Reason<span style=color:#f92672>`</span>            TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>AdjustedAction<span style=color:#f92672>`</span>    INTEGER,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>TinderUserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>TinderUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>SwiprUserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>AspNetUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=swiprtimeouts>SwiprTimeouts</h2><p>We keep a small table that keeps track of when a given Swipr user&rsquo;s Like Count will reset. This keeps us from needlessly dequeuing a presently-timed-out user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>SwiprTimeouts<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>            TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>TimeoutExpiresAt<span style=color:#f92672>`</span>  INTEGER <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>AspNetUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=swiprerrors>SwiprErrors</h2><p>Another table that prevents us from dequeuing invalid users, this table tracks things like Facebook token expiration, logon problems, or other such errors that require the actual user to intervene and remedy.</p><p>These are presented to the user on their Settings page.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>SwiprErrors<span style=color:#f92672>`</span> (
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>        TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>`</span>ErrorMsg<span style=color:#f92672>`</span>      TEXT,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#f92672>`</span>AspNetUsers<span style=color:#f92672>`</span>(<span style=color:#f92672>`</span>Id<span style=color:#f92672>`</span>) <span style=color:#66d9ef>ON</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>CASCADE</span>,
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>(<span style=color:#f92672>`</span>UserId<span style=color:#f92672>`</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h1 id=encryption>Encryption</h1><p>Storing passwords in plaintext is super-bad and we&rsquo;ll never do that.</p><p>We create our Database first by using SQLite DBBrowser, and then apply a password to it. Once the database is passworded, we use the <code>SQLitePCLRaw.bundle_sqlcipher</code> NuGet package and the SQLite extension <code>SQLCipher</code> to decode the database at runtime.</p><p>See these posts for reference:</p><p><a href=https://stackoverflow.com/questions/39903863/password-protected-sqlite-with-entity-framework-core>https://stackoverflow.com/questions/39903863/password-protected-sqlite-with-entity-framework-core</a></p><p><a href=https://www.bricelam.net/2016/06/13/sqlite-encryption.html>https://www.bricelam.net/2016/06/13/sqlite-encryption.html</a></p><p><a href=https://github.com/paragpkulkarni/SQLiteEncryptionUsingEFCore>https://github.com/paragpkulkarni/SQLiteEncryptionUsingEFCore</a></p><h1 id=moving-on>Moving On</h1><p>In our next post, we&rsquo;ll discuss the actual SwiprServer logic that unites everything together</p><p><a href=/posts/ml/swipr10>Next Section - Swipr Server</a></p><h3>Posts in this series</h3><ul><li><a href=/posts/ml/swipr10/>Swipr - Server</a></li><li><a href=/posts/ml/swipr09/>Swipr - Datastore</a></li><li><a href=/posts/ml/swipr08/>Swipr - LibSwipr</a></li><li><a href=/posts/ml/swipr07/>Swipr - Swipr Script Service</a></li><li><a href=/posts/ml/swipr06/>Swipr - Fast.ai and CNNs</a></li><li><a href=/posts/ml/swipr05/>Swipr - Data Cleaning</a></li><li><a href=/posts/ml/swipr04/>Swipr - Data Collection (Part 2 of 2)</a></li><li><a href=/posts/ml/swipr03/>Swipr - Data Collection (Part 1 of 2)</a></li><li><a href=/posts/ml/swipr02/>Swipr - Scope</a></li><li><a href=/posts/ml/swipr01/>Swipr - Overview</a></li></ul></div><div class=post__footer><span><a class=category href=/categories/machine-learning/>machine learning</a><a class=category href=/categories/fast%2eai/>fast.ai</a></span>
<span><a class=tag href=/tags/cnn/>CNN</a><a class=tag href=/tags/web-scraping/>web scraping</a><a class=tag href=/tags/data-collection/>data collection</a><a class=tag href=/tags/architecture/>architecture</a></span></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>